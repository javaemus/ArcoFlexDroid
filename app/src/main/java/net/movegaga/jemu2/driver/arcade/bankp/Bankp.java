package net.movegaga.jemu2.driver.arcade.bankp;

import net.movegaga.jemu2.driver.BaseDriver;

import java.net.URL;

import jef.cpu.Z80;
import jef.cpuboard.CpuDriver;
import jef.machine.BasicEmulator;
import jef.machine.Emulator;
import jef.machine.EmulatorProperties;
import jef.map.IOReadPort;
import jef.map.IOWritePort;
import jef.map.InputPort;
import jef.map.MemoryReadAddress;
import jef.map.MemoryWriteAddress;
import jef.map.SwitchedInterrupt;
import jef.map.WriteHandler;
import jef.sound.SoundChip;
import jef.sound.chip.SN76496;
import jef.util.RomLoader;
import jef.video.GfxDecodeInfo;

public class Bankp extends BaseDriver {
   WriteHandler bankp_out_w;
   WriteHandler bankp_scroll_w;
   int[][] charlayout;
   int[][] charlayout2;
   Z80 cpu = new Z80();
   InputPort[] in;
   IOReadPort ior;
   IOWritePort iow;
   BasicEmulator m;
   char[] mem_cpu = new char[65536];
   char[] mem_gfx1 = new char[16384];
   char[] mem_gfx2 = new char['쀀'];
   char[] mem_prom = new char[544];
   MemoryReadAddress mra;
   MemoryWriteAddress mwa;
   SwitchedInterrupt nmi_line_pulse;
   SN76496 sn0;
   SN76496 sn1;
   SN76496 sn2;
   VBankp v;

   public Bankp() {
      this.mra = new MemoryReadAddress(this.mem_cpu);
      this.mwa = new MemoryWriteAddress(this.mem_cpu);
      this.ior = new IOReadPort();
      this.iow = new IOWritePort();
      this.in = new InputPort[4];
      this.v = new VBankp(this);
      this.sn0 = new SN76496(3867120);
      this.sn1 = new SN76496(3867120);
      this.sn2 = new SN76496(3867120);
      this.bankp_scroll_w = this.v.bankp_scroll_w();
      this.bankp_out_w = this.v.bankp_out_w();
      this.m = new BasicEmulator();
      this.nmi_line_pulse = new SwitchedInterrupt(1);
      int[] var4 = new int[]{8};
      int[] var5 = new int[]{2};
      int[] var1 = new int[]{0, 4};
      int[] var3 = new int[]{67, 66, 65, 64, 3, 2, 1, 0};
      int[] var2 = new int[]{0, 8, 16, 24, 32, 40, 48, 56};
      int[] var6 = new int[]{128};
      this.charlayout = new int[][]{{8}, var4, {1024}, var5, var1, var3, var2, var6};
      var4 = new int[]{8};
      var5 = new int[]{3};
      var2 = new int[]{262144, 131072, 0};
      var1 = new int[]{7, 6, 5, 4, 3, 2, 1, 0};
      var3 = new int[]{0, 8, 16, 24, 32, 40, 48, 56};
      var6 = new int[]{64};
      this.charlayout2 = new int[][]{var4, {8}, {2048}, var5, var2, var1, var3, var6};
   }

   public Emulator createEmulator(URL var1, String var2) {
      super.createEmulator(var1, var2);
      RomLoader var9 = new RomLoader();
      var9.setZip("bankp");
      var9.setMemory(this.mem_cpu);
      var9.loadROM("epr6175.bin", 0, 16384, 71652024);
      var9.loadROM("epr6174.bin", 16384, 16384, -761588328);
      var9.loadROM("epr6173.bin", '耀', 16384, -1203741384);
      var9.loadROM("epr6176.bin", '쀀', 8192, -913653248);
      var9.setMemory(this.mem_gfx1);
      var9.loadROM("epr6165.bin", 0, 8192, -1359787373);
      var9.loadROM("epr6166.bin", 8192, 8192, -904672495);
      var9.setMemory(this.mem_gfx2);
      var9.loadROM("epr6172.bin", 0, 8192, -993753205);
      var9.loadROM("epr6171.bin", 8192, 8192, -1585355359);
      var9.loadROM("epr6170.bin", 16384, 8192, -1249203974);
      var9.loadROM("epr6169.bin", 24576, 8192, 446922702);
      var9.loadROM("epr6168.bin", '耀', 8192, 99854439);
      var9.loadROM("epr6167.bin", 'ꀀ', 8192, 1067661281);
      var9.setMemory(this.mem_prom);
      var9.loadROM("pr6177.clr", 0, 32, -344930898);
      var9.loadROM("pr6178.clr", 32, 256, 181182465);
      var9.loadROM("pr6179.clr", 288, 256, -449073189);
      var9.loadZip(var1);
      this.in[0] = new InputPort();
      this.in[0].setBit(1, 0, 0);
      this.in[0].setBit(2, 0, 9);
      this.in[0].setBit(4, 0, 0);
      this.in[0].setBit(8, 0, 8);
      this.in[0].setBit(16, 0, 12);
      this.in[0].setBit(32, 0, 1);
      this.in[0].setBit(64, 0, 2);
      this.in[0].setBit(128, 0, 13);
      this.in[1] = new InputPort();
      this.in[1].setBit(1, 0, 0);
      this.in[1].setBit(2, 0, 9);
      this.in[1].setBit(4, 0, 0);
      this.in[1].setBit(8, 0, 8);
      this.in[1].setBit(16, 0, 140);
      this.in[1].setBit(32, 0, 4);
      this.in[1].setBit(64, 0, 5);
      this.in[1].setBit(128, 0, 141);
      this.in[2] = new InputPort();
      this.in[2].setBit(1, 0, 14);
      this.in[2].setBit(2, 0, 142);
      this.in[2].setBit(4, 0, 2);
      this.in[2].setBits(248, 248);
      this.in[3] = new InputPort();
      this.in[3].setBits(255, 192);
      this.mwa.setMW(0, '\udfff', 1);
      this.mwa.set('\uf000', '\uf7ff', this.v);
      this.mwa.set('\uf800', '\uffff', this.v.writeVRAM2());
      this.ior.set(0, 0, this.in[0]);
      this.ior.set(1, 1, this.in[1]);
      this.ior.set(2, 2, this.in[2]);
      this.ior.set(4, 4, this.in[3]);
      this.iow.set(0, 0, this.sn0.getWriteCommandHandler());
      this.iow.set(1, 1, this.sn1.getWriteCommandHandler());
      this.iow.set(2, 2, this.sn2.getWriteCommandHandler());
      this.iow.set(5, 5, this.bankp_scroll_w);
      this.iow.set(7, 7, this.bankp_out_w);
      GfxDecodeInfo var8 = new GfxDecodeInfo(this.mem_gfx1, 0, this.charlayout, 0, 32);
      GfxDecodeInfo var3 = new GfxDecodeInfo(this.mem_gfx2, 0, this.charlayout2, 128, 16);
      CpuDriver var6 = new CpuDriver(this.cpu, 3867120, this.mra, this.mwa, this.ior, this.iow, this.nmi_line_pulse, 1);
      SN76496 var4 = this.sn0;
      SN76496 var10 = this.sn1;
      SN76496 var5 = this.sn2;
      EmulatorProperties var7 = new EmulatorProperties();
      var7.setCpuDriver(new CpuDriver[]{var6});
      var7.setFPS(60);
      var7.setVideoDimensions(256, 256);
      var7.setVisibleArea(24, 247, 16, 239);
      var7.setGfxDecodeInfo(new GfxDecodeInfo[]{var8, var3});
      var7.setPaletteLength(32);
      var7.setColorTableLength(256);
      var7.setVideoEmulation(this.v);
      var7.setInputPorts(this.in);
      var7.setSoundChips(new SoundChip[]{var4, var10, var5});
      this.v.init(var7);
      this.m.init(var7);
      return this.m;
   }
}
