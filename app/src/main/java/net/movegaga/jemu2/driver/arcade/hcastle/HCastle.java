package net.movegaga.jemu2.driver.arcade.hcastle;

import net.movegaga.jemu2.driver.BaseDriver;

import java.net.URL;

import jef.cpu.Cpu;
import jef.cpu.konami.Konami;
import jef.cpu.z80.Z80;
import jef.cpuboard.CpuDriver;
import jef.machine.BasicEmulator;
import jef.machine.Emulator;
import jef.machine.EmulatorProperties;
import jef.map.InputPort;
import jef.map.MemoryReadAddress;
import jef.map.MemoryWriteAddress;
import jef.map.Register;
import jef.map.SwitchedInterrupt;
import jef.util.RomLoader;

public class HCastle extends BaseDriver {
   static final int VIDEO_GFX_BANK = 1048;
   static final int VIDEO_PALETTE = 1536;
   static final int VIDEO_PALETTE_SIZE = 256;
   Cpu cpu1 = new Konami();
   Cpu cpu2;
   K007121 k007121_1;
   K007121 k007121_2;
   char[] mem_cpu1 = new char[196608];
   char[] mem_cpu2;
   char[] mem_gfx1;
   char[] mem_gfx2;
   char[] mem_prom;
   char[] mem_sound;
   MemoryReadAddress mra1;
   MemoryWriteAddress mwa1;
   Register soundLatch;
   Renderer video;

   public HCastle() {
      this.mwa1 = new MemoryWriteAddress(this.mem_cpu1);
      this.mra1 = new MemoryReadAddress(this.mem_cpu1);
      this.cpu2 = new Z80();
      this.mem_cpu2 = new char[65536];
      this.video = new Renderer(this);
      this.mem_gfx1 = new char[1048576];
      this.mem_gfx2 = new char[1048576];
      this.mem_prom = new char[1280];
      this.k007121_1 = new K007121();
      this.k007121_2 = new K007121();
      this.mem_sound = new char[524288];
      this.soundLatch = new Register();
   }

   public Emulator createEmulator(URL var1, String var2) {
      super.createEmulator(var1, var2);
      RomLoader var5 = new RomLoader();
      var5.setZip("hcastle");
      var5.setMemory(this.mem_cpu1);
      var5.loadROM("768.k03", '耀', '耀', 1087262520);
      var5.loadROM("768.g06", 65536, 131072, -844240608);
      var5.setMemory(this.mem_cpu2);
      var5.loadROM("768.e01", 0, '耀', -1174408828);
      var5.setMemory(this.mem_gfx1);
      var5.loadROM("d95.g21", 0, 524288, -474071075);
      var5.loadROM("d94.g19", 524288, 524288, -1774986357);
      var5.setMemory(this.mem_gfx2);
      var5.loadROM("d91.j5", 0, 524288, 694183950);
      var5.loadROM("d92.j6", 524288, 524288, 1705177639);
      var5.setMemory(this.mem_prom);
      var5.loadROM("768c13.j21", 0, 256, -169967413);
      var5.loadROM("768c14.j22", 256, 256, -1289719369);
      var5.loadROM("768c11.i4", 512, 256, -169967413);
      var5.loadROM("768c10.i3", 768, 256, -1289719369);
      var5.loadROM("768b12.d20", 1024, 256, 908412088);
      var5.setMemory(this.mem_sound);
      var5.loadROM("d93.e17", 0, 524288, 33130652);
      var5.loadZip(var1);
      InputPort[] var6 = new InputPort[6];
      var6[0] = new InputPort();
      var6[0].setBit(1, 1);
      var6[0].setBit(2, 2);
      var6[0].setBit(4, 2);
      var6[0].setBit(8, 4);
      var6[0].setBit(16, 5);
      var6[0].setBits(224, 224);
      var6[1] = new InputPort();
      var6[1].setBit(1, 8);
      var6[1].setBit(2, 9);
      var6[1].setBit(4, 10);
      var6[1].setBit(8, 11);
      var6[1].setBit(16, 12);
      var6[1].setBit(32, 13);
      var6[1].setBit(192, 192);
      var6[2] = new InputPort();
      var6[2].setBits(255, 255);
      var6[3] = new InputPort();
      var6[3].setBits(255, 123);
      var6[4] = new InputPort();
      var6[4].setBits(255, 255);
      var6[5] = new InputPort();
      var6[5].setBits(255, 255);
      this.mra1.setMR(32, 63, 0);
      this.mra1.setMR(544, 575, 0);
      this.mra1.set(1040, 1040, var6[0]);
      this.mra1.set(1041, 1041, var6[1]);
      this.mra1.set(1042, 1042, var6[2]);
      this.mra1.set(1043, 1043, var6[5]);
      this.mra1.set(1044, 1044, var6[4]);
      this.mra1.set(1045, 1045, var6[3]);
      this.mra1.setMR(1048, 1048, 0);
      this.mra1.setMR(1536, 1791, 0);
      this.mra1.setMR(1792, 24575, 0);
      this.mra1.setMR(24576, 32767, 3);
      this.mra1.setMR('耀', '\uffff', 1);
      this.mwa1.setMW(32, 63, 0);
      this.mwa1.setMW(544, 575, 0);
      this.mwa1.set(1028, 1028, this.soundLatch);
      this.mwa1.setMW(1048, 1048, 0);
      this.mwa1.set(1536, 1791, this.video);
      this.mwa1.setMW(1792, 8191, 0);
      this.mwa1.set(8192, 16383, this.k007121_1);
      this.mwa1.set(16384, 24575, this.k007121_2);
      this.mwa1.setMW(24576, '\uffff', 1);
      EmulatorProperties var4 = new EmulatorProperties();
      CpuDriver[] var3 = new CpuDriver[]{new CpuDriver(this.cpu1, 3000000, this.mra1, this.mwa1, new SwitchedInterrupt(0), 1)};
      var3[1].isAudioCpu = true;
      var4.setCpuDriver(var3);
      var4.setTimeSlicesPerFrame(100);
      var4.setFPS(60);
      var4.setDynamicPalette(true);
      var4.setVideoWidth(256);
      var4.setVideoHeight(256);
      var4.setVisibleArea(0, 255, 16, 239);
      var4.setPaletteLength(256);
      var4.setVideoEmulation(this.video);
      var4.setInputPorts(var6);
      BasicEmulator var7 = new BasicEmulator();
      var7.init(var4);
      return var7;
   }
}
