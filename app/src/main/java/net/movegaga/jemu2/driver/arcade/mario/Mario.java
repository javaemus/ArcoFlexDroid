package net.movegaga.jemu2.driver.arcade.mario;

import net.movegaga.jemu2.driver.BaseDriver;

import java.net.URL;

import jef.cpu.Z80;
import jef.cpuboard.CpuDriver;
import jef.machine.BasicEmulator;
import jef.machine.Emulator;
import jef.machine.EmulatorProperties;
import jef.map.InputPort;
import jef.map.MemoryReadAddress;
import jef.map.MemoryWriteAddress;
import jef.map.ReadMap;
import jef.map.SwitchedInterrupt;
import jef.map.WriteHandler;
import jef.map.WriteMap;
import jef.scoring.HighScoreParser;
import jef.util.RomLoader;
import jef.video.GfxDecodeInfo;

public class Mario extends BaseDriver {
   final int[][] charLayout;
   Z80 cpu1 = new Z80();
   BasicEmulator emu = new BasicEmulator();
   WriteHandler enableInterrupt;
   InputPort[] in;
   SwitchedInterrupt interrupt1;
   char[] mem_cpu1 = new char[65536];
   char[] mem_gfx1;
   char[] mem_gfx2;
   char[] mem_prom;
   ReadMap mra1;
   WriteMap mwa1;
   final int[][] spriteLayout;
   VMario video;
   WriteHandler writeGfxBank;
   WriteHandler writePaletteBank;

   public Mario() {
      this.mra1 = new MemoryReadAddress(this.mem_cpu1);
      this.mwa1 = new MemoryWriteAddress(this.mem_cpu1);
      this.interrupt1 = new SwitchedInterrupt(1);
      this.enableInterrupt = this.interrupt1;
      this.video = new VMario(this);
      this.mem_gfx1 = new char[8192];
      this.mem_gfx2 = new char[24576];
      this.mem_prom = new char[512];
      this.writeGfxBank = this.video.writeGfxBank();
      this.writePaletteBank = this.video.writePaletteBank();
      this.in = new InputPort[3];
      int[] var4 = new int[]{8};
      int[] var5 = new int[]{8};
      int[] var2 = new int[]{0, '耀'};
      int[] var1 = new int[]{0, 1, 2, 3, 4, 5, 6, 7};
      int[] var3 = new int[]{0, 8, 16, 24, 32, 40, 48, 56};
      int[] var6 = new int[]{64};
      this.charLayout = new int[][]{var4, var5, {512}, {2}, var2, var1, var3, var6};
      var4 = new int[]{16};
      var5 = new int[]{16};
      var6 = new int[]{256};
      int[] var7 = new int[]{3};
      var3 = new int[]{0, 65536, 131072};
      var1 = new int[]{0, 1, 2, 3, 4, 5, 6, 7, '耀', '老', '耂', '考', '耄', '者', '耆', '耇'};
      var2 = new int[]{0, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120};
      this.spriteLayout = new int[][]{var4, var5, var6, var7, var3, var1, var2, {128}};
   }

   public Emulator createEmulator(URL var1, String var2) {
      super.createEmulator(var1, var2);
      this.in[0] = new InputPort();
      this.in[0].setBit(1, 0, 9);
      this.in[0].setBit(2, 0, 8);
      this.in[0].setBit(4, 0, 0);
      this.in[0].setBit(8, 0, 0);
      this.in[0].setBit(16, 0, 12);
      this.in[0].setBit(32, 0, 4);
      this.in[0].setBit(64, 0, 5);
      this.in[1] = new InputPort();
      this.in[1].setBit(1, 0, 137);
      this.in[1].setBit(2, 0, 136);
      this.in[1].setBit(4, 0, 0);
      this.in[1].setBit(8, 0, 0);
      this.in[1].setBit(16, 0, 140);
      this.in[1].setBit(32, 0, 2);
      this.in[1].setBit(64, 0, 1);
      this.in[1].setBit(128, 0, 0);
      this.in[2] = new InputPort();
      this.in[2].setDipName(3, 0, "Lives");
      this.in[2].setDipName(12, 0, "Coinage");
      this.in[2].setDipName(48, 0, "Bonus Life");
      this.in[2].setDipName(192, 0, "Difficulty");
      this.mra1.setMR(0, 24575, 1);
      this.mra1.setMR(24576, 28671, 0);
      this.mra1.setMR(29696, 30719, 0);
      this.mra1.set(31744, 31744, this.in[0]);
      this.mra1.set(31872, 31872, this.in[1]);
      this.mra1.set(32640, 32640, this.in[2]);
      this.mra1.setMR('\uf000', '\uffff', 1);
      this.mwa1.setMW(0, 24575, 1);
      this.mwa1.setMW(24576, 26879, 0);
      this.mwa1.setMW(27264, 28671, 0);
      this.mwa1.setMW(26880, 27263, 0);
      this.mwa1.set(29696, 30719, this.video);
      this.mwa1.setMW(32000, 32000, 0);
      this.mwa1.set(32384, 32384, this.writeGfxBank);
      this.mwa1.set(32387, 32387, this.writePaletteBank);
      this.mwa1.set(32388, 32388, this.enableInterrupt);
      this.mwa1.setMW(28672, 29695, 2);
      this.mwa1.setMW('\uf000', '\uffff', 1);
      RomLoader var6 = new RomLoader();
      var6.setZip("mario");
      var6.setMemory(this.mem_cpu1);
      var6.loadROM("mario.7f", 0, 8192, -1060708332);
      var6.loadROM("mario.7e", 8192, 8192, 292239446);
      var6.loadROM("mario.7d", 16384, 8192, -590432575);
      var6.loadROM("mario.7c", '\uf000', 4096, 1248057707);
      var6.setMemory(this.mem_gfx1);
      var6.loadROM("mario.3f", 0, 4096, 682673196);
      var6.loadROM("mario.3j", 4096, 4096, 210550861);
      var6.setMemory(this.mem_gfx2);
      var6.loadROM("mario.7m", 0, 4096, 582432558);
      var6.loadROM("mario.7n", 4096, 4096, 1329209159);
      var6.loadROM("mario.7p", 8192, 4096, 1455320269);
      var6.loadROM("mario.7s", 12288, 4096, 1458689555);
      var6.loadROM("mario.7t", 16384, 4096, 1679753224);
      var6.loadROM("mario.7u", 20480, 4096, 2075087625);
      var6.setMemory(this.mem_prom);
      var6.loadROM("mario.4p", 0, 512, -1345733311);
      var6.loadZip(var1);
      GfxDecodeInfo var3 = new GfxDecodeInfo(this.mem_gfx1, 0, this.charLayout, 0, 16);
      GfxDecodeInfo var5 = new GfxDecodeInfo(this.mem_gfx2, 0, this.spriteLayout, 64, 32);
      CpuDriver var7 = new CpuDriver(this.cpu1, 3072000, this.mra1, this.mwa1, this.interrupt1, 1);
      EmulatorProperties var4 = new EmulatorProperties();
      var4.setCpuDriver(new CpuDriver[]{var7});
      var4.setFPS(60);
      var4.setVideoDimensions(256, 256);
      var4.setVisibleArea(0, 255, 16, 239);
      var4.setGfxDecodeInfo(new GfxDecodeInfo[]{var3, var5});
      var4.setPaletteLength(256);
      var4.setColorTableLength(320);
      var4.setPaletteInitializer(this.video);
      var4.setVideoUpdater(this.video);
      var4.setInputPorts(this.in);
      var4.setRotation(2);
      this.video.init(var4);
      this.emu.init(var4);
      new HighScoreParser(this.emu, this.mem_cpu1, 57, 0, 0, 30651, 1, 30646, 0, 1);
      return this.emu;
   }
}
